<%# 
PARTIAL ROUTE: partials/article-annotation.ejs
PARTIAL DESCRIPTION: Allow users to write annotations for Lexical Articles
LOCAL VARIABLES:
---------------------------------- 
- locals.includeAnnotation (boolean): Whether or not to include annotation form
- locals.auth (number): Authentication level
- locals.annotation_path (string): URL to use for when you are posting annotation 
%>

<%if(locals.includeAnnotation){%>
<div id="include-annotation-form" data-annotate-form <%-locals.auth>=1?'class="mt-2"':''%> hx-swap-oob="outerHTML" 
    <%-locals.auth>=1?'style="max-width: var(--max-width-toc); background-color: var(--background); padding: 2px; border-radius: 3px;"':'style="max-width: var(--max-width-toc); background-color: var(--background); border-radius: 3px;"'%>
    
>
    <%if(locals.auth>=1){%>
        <div class="flex-row justify-between gap-2 align-center bb">
            <p class="h4 bold">Add Annotation:</p>
            <button id="hide-show-annotation-form" type="button" class="small icon-text text warning" data-hide-show="" data-el="#add-annotation-form">
            <svg data-arrow="" focusable="false" inert viewBox="0 0 24 24" tabindex="-1" title="KeyboardArrowUp"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg>
              <span data-hide="">HIDE</span>
            <span data-show="" hidden="">SHOW</span>
            </button>
        </div>
        <form id="add-annotation-form" data-click-capture data-loading="Submitting annotation..." hx-trigger="submit" hx-post="<%=locals.annotation_path%>" hx-target="#annotation-output" hx-swap="innerHTML">
            <p class="body2 bg-info fw-regular mt-1 p-sm" style="border-radius: 6px;">
                Highlight text then click the annotation button to add an annotation to the article.
            </p>
            <div class="block lexical-wrapper mt-2" id="annotate-editor">
                <div role="toolbar" class="toggle-button-group hz-scroll">
                    <div role="toolbar" class="toggle-button-group subgroup">
                        <div>
                <button data-lexical-bg-color-button="" aria-haspopup="dialog" data-popover="" data-click="" data-pelem="#lexical-background-color-menu_a8bce539-253c-4b54-b3b7-59501b895543" data-force-close="" type="button" class="toggle-button" aria-label="Background Color">
                    <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="FormatColorFillSharp">
                        <path d="M10 17.62 17.62 10l-10-10-1.41 1.41 2.38 2.38L2.38 10 10 17.62zm0-12.41L14.79 10H5.21L10 5.21zM19 17c1.1 0 2-.9 2-2 0-1.33-2-3.5-2-3.5s-2 2.17-2 3.5c0 1.1.9 2 2 2zM2 20h20v4H2z">
                        </path>
                    </svg>
                </button>
                </div>
                <div data-click-capture="" class="floating-menu o-xs" style="min-width: 150px;" data-placement="bottom-end" id="lexical-background-color-menu_a8bce539-253c-4b54-b3b7-59501b895543">
                <label class="body2" for="lexical-background-color-1_a8bce539-253c-4b54-b3b7-59501b895543">Background Color:</label>
                <div class="flex-row justify-begin align-center gap-2">
                    <input data-lexical-background-color="" type="color" data-coloris="" name="lexical-background-color-1_a8bce539-253c-4b54-b3b7-59501b895543" id="lexical-background-color-1_a8bce539-253c-4b54-b3b7-59501b895543" value="#384000" style="margin-top: 2px;">
                    <span class="body2">#384000</span>
                </div>
                <label class="checkbox mt-1">
                    <input data-lexical-background-transparent="" checked="" type="checkbox" class="secondary" name="lex-background-color-transparent_a8bce539-253c-4b54-b3b7-59501b895543" id="lex-background-color-transparent_a8bce539-253c-4b54-b3b7-59501b895543">
                    Transparent
                </label>
                </div>
                <div>
                <button data-lexical-text-color-button="" data-popover="" data-pelem="#lexical-text-color-menu_a8bce539-253c-4b54-b3b7-59501b895543" data-force-close="" aria-haspopup="dialog" data-click="" type="button" class="toggle-button" aria-label="Text Color">
                    <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="FormatColorTextSharp">
                        <path d="M2 20h20v4H2v-4zm3.49-3h2.42l1.27-3.58h5.65L16.09 17h2.42L13.25 3h-2.5L5.49 17zm4.42-5.61 2.03-5.79h.12l2.03 5.79H9.91z">
                        </path>
                    </svg>
                </button>
                </div>
                <div data-click-capture="" class="floating-menu o-xs" style="min-width: 150px;" data-placement="bottom-end" id="lexical-text-color-menu_a8bce539-253c-4b54-b3b7-59501b895543">
                <label class="body2" for="lexical-text-color-1_a8bce539-253c-4b54-b3b7-59501b895543">Text Color:</label>
                <div class="flex-row justify-begin align-center gap-2">
                    <input data-lexical-text-color="" type="color" data-coloris="" name="lexical-text-color-1_a8bce539-253c-4b54-b3b7-59501b895543" id="lexical-text-color-1_a8bce539-253c-4b54-b3b7-59501b895543" value="#ffffff" style="margin-top: 2px;">
                    <span class="body2">#ffffff</span>
                </div>
                <label class="checkbox mt-1">
                    <input data-lexical-text-transparent="" checked="" type="checkbox" class="secondary" name="lex-text-color-transparent_a8bce539-253c-4b54-b3b7-59501b895543" id="lex-text-color-transparent_a8bce539-253c-4b54-b3b7-59501b895543">
                    Inherit
                </label>
                </div>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="bold" type="button" class="toggle-button" aria-label="Bold">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="FormatBoldSharp">
                                <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="italic" type="button" class="toggle-button" aria-label="Italic">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="FormatItalicSharp">
                                <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"></path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="strikethrough" type="button" class="toggle-button" aria-label="Strikethrough">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="StrikethroughSSharp">
                                <path d="M7.24 8.75c-.26-.48-.39-1.03-.39-1.67 0-.61.13-1.16.4-1.67.26-.5.63-.93 1.11-1.29.48-.35 1.05-.63 1.7-.83.66-.19 1.39-.29 2.18-.29.81 0 1.54.11 2.21.34.66.22 1.23.54 1.69.94.47.4.83.88 1.08 1.43s.38 1.15.38 1.81h-3.01c0-.31-.05-.59-.15-.85-.09-.27-.24-.49-.44-.68-.2-.19-.45-.33-.75-.44-.3-.1-.66-.16-1.06-.16-.39 0-.74.04-1.03.13s-.53.21-.72.36c-.19.16-.34.34-.44.55-.1.21-.15.43-.15.66 0 .48.25.88.74 1.21.38.25.77.48 1.41.7H7.39c-.05-.08-.11-.17-.15-.25zM21 12v-2H3v2h9.62c.18.07.4.14.55.2.37.17.66.34.87.51s.35.36.43.57c.07.2.11.43.11.69 0 .23-.05.45-.14.66-.09.2-.23.38-.42.53-.19.15-.42.26-.71.35-.29.08-.63.13-1.01.13-.43 0-.83-.04-1.18-.13s-.66-.23-.91-.42c-.25-.19-.45-.44-.59-.75s-.25-.76-.25-1.21H6.4c0 .55.08 1.13.24 1.58s.37.85.65 1.21c.28.35.6.66.98.92.37.26.78.48 1.22.65.44.17.9.3 1.38.39.48.08.96.13 1.44.13.8 0 1.53-.09 2.18-.28s1.21-.45 1.67-.79c.46-.34.82-.77 1.07-1.27s.38-1.07.38-1.71c0-.6-.1-1.14-.31-1.61-.05-.11-.11-.23-.17-.33H21V12z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="underline" type="button" class="toggle-button" aria-label="Underline">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="FormatUnderlinedSharp">
                                <path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="kbd" type="button" class="toggle-button" aria-label="Insert Keyboard Command">
                            <svg viewBox="0 0 576 512" title="keyboard" focusable="false" inert="" tabindex="-1">
                                <path d="M64 64C28.7 64 0 92.7 0 128V384c0 35.3 28.7 64 64 64H512c35.3 0 64-28.7 64-64V128c0-35.3-28.7-64-64-64H64zm16 64h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16zM64 240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V240zm16 80h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm80-176c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V144zm16 80h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V240c0-8.8 7.2-16 16-16zM160 336c0-8.8 7.2-16 16-16H400c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336zM272 128h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H272c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16zM256 240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H272c-8.8 0-16-7.2-16-16V240zM368 128h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H368c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16zM352 240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H368c-8.8 0-16-7.2-16-16V240zM464 128h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H464c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16zM448 240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H464c-8.8 0-16-7.2-16-16V240zm16 80h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H464c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="quote" type="button" class="toggle-button" aria-label="Insert Quote">
                            <svg viewBox="0 0 448 512" title="quote-left" focusable="false" inert="" tabindex="-1">
                                <path d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V320 288 216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H320c-35.3 0-64-28.7-64-64V320 288 216z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="superscript" type="button" class="toggle-button" aria-label="Superscript">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="SuperscriptSharp">
                                <path d="M20 7v1h3v1h-4V6h3V5h-3V4h4v3h-3zM5.88 20h2.66l3.4-5.42h.12l3.4 5.42h2.66l-4.65-7.27L17.81 6h-2.68l-3.07 4.99h-.12L8.85 6H6.19l4.32 6.73L5.88 20z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="FORMAT_TEXT_COMMAND" data-payload="subscript" type="button" class="toggle-button" aria-label="Subscript">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="SubscriptSharp">
                                <path d="M20 18v1h3v1h-4v-3h3v-1h-3v-1h4v3h-3zM5.88 18h2.66l3.4-5.42h.12l3.4 5.42h2.66l-4.65-7.27L17.81 4h-2.68l-3.07 4.99h-.12L8.85 4H6.19l4.32 6.73L5.88 18z">
                                </path>
                            </svg>
                        </button>
                        <button data-dispatch="CLEAR_TEXT_FORMATTING" type="button" class="toggle-button" aria-label="Clear Text Formatting">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="FormatClear">
                                <path d="M3.27 5 2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21 18 19.73 3.55 5.27 3.27 5zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V5H6z">
                                </path>
                            </svg>
                        </button>
                        <div>
                        <button data-lexical-link-button="" data-click="" type="button" class="toggle-button" aria-label="Insert Link" aria-haspopup="dialog" data-popover="" data-pelem="#lexical-insert-link-main_a8bce539-253c-4b54-b3b7-59501b895543" data-force-close="">
                            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="Link"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg>
                        </button>
                        </div>
                        <button data-lexical-block-style-button="" type="button" data-click="" aria-haspopup="dialog" data-dialog="lexical-block-edit-dialog" class="toggle-button" aria-label="Edit block elements in selection"><svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="SettingsSuggest"><path d="M17.41 6.59 15 5.5l2.41-1.09L18.5 2l1.09 2.41L22 5.5l-2.41 1.09L18.5 9l-1.09-2.41zm3.87 6.13L20.5 11l-.78 1.72-1.72.78 1.72.78.78 1.72.78-1.72L23 13.5l-1.72-.78zm-5.04 1.65 1.94 1.47-2.5 4.33-2.24-.94c-.2.13-.42.26-.64.37l-.3 2.4h-5l-.3-2.41c-.22-.11-.43-.23-.64-.37l-2.24.94-2.5-4.33 1.94-1.47c-.01-.11-.01-.24-.01-.36s0-.25.01-.37l-1.94-1.47 2.5-4.33 2.24.94c.2-.13.42-.26.64-.37L7.5 6h5l.3 2.41c.22.11.43.23.64.37l2.24-.94 2.5 4.33-1.94 1.47c.01.12.01.24.01.37s0 .24-.01.36zM13 14c0-1.66-1.34-3-3-3s-3 1.34-3 3 1.34 3 3 3 3-1.34 3-3z"></path></svg></button>
                    </div>
                </div>
                <div data-lexical-link-popup="" id="lexical-insert-link-main_a8bce539-253c-4b54-b3b7-59501b895543" role="dialog" class="floating-menu o-xs" style="padding:4px;border-radius:6px; max-width: 500px!important; width: 400px!important;" data-placement="top-start" data-click-capture="">
                        <div class="input-group block" data-hover="false" data-focus="false" data-error="false" data-blurred="false">
                            <label for="lex-insert-link-main-url_a8bce539-253c-4b54-b3b7-59501b895543">Link URL:</label>
                            <div class="text-input block medium">
                                <input data-lexical-link-input="" name="lex-insert-link-main-url_a8bce539-253c-4b54-b3b7-59501b895543" id="lex-insert-link-main-url_a8bce539-253c-4b54-b3b7-59501b895543" class="mt-1 
                                medium icon-before" placeholder="Enter the URL of the link..." maxlength="1500" autocomplete="off" autocapitalize="on" spellcheck="false" type="url" style="padding: 5px 12px;">
                                <svg class="icon-before" focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="Link">
                                    <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        <p hidden="" class="caption t-warning" data-error-text="">
                            Please input a valid url.
                        </p>
                        <div class="mt-1 flex-row w-100 justify-between align-center">
                            <button data-close-menu="" class="warning filled small" type="button">
                            CLOSE
                            </button>
                            <div>
                            <button hidden="" class="filled error small" type="button" data-lexical-remove-link="" style="margin-right: 4px;">
                                REMOVE LINK
                            </button>
                            <button class="filled success small" type="button" data-lexical-link-submit="">
                                SUBMIT
                            </button>
                            </div>
                        </div>
                            
                </div>
                <div contenteditable data-rich-text-editor="" data-type="annotation" data-editable="true" spellcheck="true" style="max-height: 400px; min-height: 100px; resize: vertical!important; overflow-y: auto; user-select: text; white-space: pre-wrap; word-break: break-word;" data-lexical-editor="true"><p class="lex-p" style="text-align: left; margin: 0px 0px 0px 0px; padding: 0px 0px 0px 0px !important;" data-v="1" dir="ltr" data-e-indent="0"><span data-v="1" style="white-space: pre-wrap;">Insert article annotation here...</span></p></div>
            </div>
            <input type="number" name="annotation-start" id="annotation-start" hidden readonly>
            <input type="number" name="annotation-end" id="annotation-end" hidden readonly>
            <input type="text" name="annotation-content" id="annotation-content" hidden readonly>
            <input type="text" name="annotation-reference-id" id="annotation-reference-id" hidden readonly>
            <div class="lexical-wrapper" data-annotation-form-lexical id="lexical_annotate_random_<%=Math.random().toString().slice(2)%>" contenteditable data-rich-text-editor="" data-type="full" data-editable="true" spellcheck="true" hidden data-lexical-editor="true"></div>


            <div class="flex-row justify-end mt-2">
                <button <%-locals.auth<1?'disabled':''%> type="submit" aria-label="Submit" class="success filled icon-text medium">
                    <svg focusable="false" inert viewBox="0 0 24 24" tabindex="-1" title="Send"><path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    SUBMIT
                </button>
            </div>
        </form>
        <output class="block" id="annotation-output"></output>
    <%}%>
    <%if (!!!locals.includeAnnotationFormOnly){%>
        <form id="show-annotation-form" class="mt-1">
            <p class="h4 bold bb">Show Annotations:</p>
            <label class="checkbox mt-2">
                <input type="checkbox" 
                class="primary" 
                name="show-annotations" 
                id="show-annotations"
                hx-trigger="change" 
                hx-get="<%-locals.path%>"
                hx-target="#show-annotation-form-output" 
                hx-swap="innerHTML" 
                hx-indicator="#an_faad61d7-077d-4a22-b0d4-edea0ea86c11"
                hx-include="#annotation-search-options-form, #search-annotations-searchbox, #show-annotations, #annotate-sort-input, #search-comments-searchbox, #search-comments-options-form, #comment-sort-by"
                hx-push-url="true"
                <%-locals.show_annotations_checked?'checked':''%>
                >
                Show Annotations
            </label>
        </form>
        <div class="flex-row justify-center t-primary mt-1 htmx-indicator" role="progressbar" aria-busy="false" aria-label="Getting Annotations" id="an_faad61d7-077d-4a22-b0d4-edea0ea86c11">
        <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
        </div>
        <output id="show-annotation-form-output">
            <%-locals.annotation_main_str%>
        </output>
        <div class="flex-row justify-start bb">
            <p class="h4 bold">Search Annotations:</p>
        </div>
        <div class="input-group flex-row align-center gap-1 w-100 mt-1" data-hover="false" data-focus="false" data-error="false" data-blurred="false">
        <div class="text-input block medium">
            <input 
            type="search"
            name="search-annotations" 
            id="search-annotations-searchbox"
            placeholder="Search annotations..." 
            style="padding: 0.5rem 0.5rem!important;"
            hx-get="<%-locals.path%>"
            hx-include="#annotation-search-options-form, #search-annotations-searchbox, #show-annotations, #annotate-sort-input, #search-comments-searchbox, #search-comments-options-form, #comment-sort-by"
            hx-push-url="true"
            hx-target="#annotation-search-output"
            hx-swap="innerHTML"
            hx-indicator="#search-annotations-ind"
            hx-trigger="search"
            value="<%=locals.search_annotations_value%>"
            >
        </div>
        <div id="annotation-search-op-pop" class="floating-menu" role="dialog" data-click-capture data-placement="top-end">
            <form 
            action="none" 
            id="annotation-search-options-form" 
            hx-trigger="change"
            hx-get="<%-locals.path%>"
            hx-include="#annotation-search-options-form, #search-annotations-searchbox, #show-annotations, #annotate-sort-input, #search-comments-searchbox, #search-comments-options-form, #comment-sort-by"
            hx-push-url="true"
            hx-target="#annotation-search-output"
            hx-swap="innerHTML"
            hx-indicator="#search-annotations-ind"
            >
                <fieldset>
                    <legend class="h6 bold">Annotation Search Options</legend>
                    <label class="radio">
                    <input type="radio" name="annotation-search-type" value="default" class="warning" <%-locals.search_annotations_type==="default"?'checked':''%>>
                    Default Search
                    </label>
                    <label class="radio">
                    <input type="radio" name="annotation-search-type" value="semantic" class="error" <%-locals.search_annotations_type==="semantic"?'checked':''%>>
                    Semantic Search
                    </label>
                </fieldset>
            </form>
        </div>
        <button type="button" data-popover data-pelem="#annotation-search-op-pop" data-click data-force-close class="icon medium" aria-label="Annotation Search Options">
            <svg focusable="false" inert viewBox="0 0 24 24" tabindex="-1" title="MoreVert"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
        </button>
        <button type="button" class="icon medium filled info" aria-label="Search Annotations"
        hx-get="<%-locals.path%>"
        hx-include="#annotation-search-options-form, #search-annotations-searchbox, #show-annotations, #annotate-sort-input, #search-comments-searchbox, #search-comments-options-form, #comment-sort-by"
        hx-push-url="true"
        hx-target="#annotation-search-output"
        hx-swap="innerHTML"
        hx-indicator="#search-annotations-ind"
        hx-trigger="click"
        >
            <svg focusable="false" inert="" viewBox="0 0 24 24" tabindex="-1" title="Search"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
        </button>
        </div>
        <div id="search-annotations-ind" class="flex-row justify-center t-primary htmx-indicator" role="progressbar" aria-busy="false" aria-label="Searching annotations" >
        <div class="lds-dual-ring"></div>
        </div>
        <div class="mt-1" id="annotation-search-output" style="max-height: 250px; overflow-y: auto; scrollbar-width: none;">
            <%-locals.annotation_search_str%>
        </div>
    <%}%>
</div>
<%}else {%>
<div id="include-annotation-form" hidden  hx-swap-oob="outerHTML">
    <script nonce="<%=locals.jsNonce%>">
        (() => {
            for (const [name, highlight] of CSS.highlights.entries()) {
                if (name.startsWith("user-highlight-")) {
                    highlight.clear();
                }
            }
        })()
    </script>
</div>
<%}%>
