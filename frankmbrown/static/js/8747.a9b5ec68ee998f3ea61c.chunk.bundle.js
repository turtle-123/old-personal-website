"use strict";(self.webpackChunkbundled_client_code=self.webpackChunkbundled_client_code||[]).push([[8747],{78747:function(e,r,t){t.r(r),t.d(r,{onSurveyLoad:function(){return d}});var i=t(8189),n=t(60429),u=new Set(["survey-short-answer","survey-paragraph","survey-short-blog","survey-multiple-choice","survey-checkbox","survey-range","survey-date","survey-datetime","survey-time","survey-image","survey-audio","survey-video","survey-month","survey-color","survey-ranking","survey-selection","survey-number","survey-week"]),o=function(e,r){document.dispatchEvent(new CustomEvent("DISPATCH_SNACKBAR",{detail:{severity:e,message:r}}))},s=function(e,r){e.classList.add("invalid-q"),e.scrollIntoView(),o("error",r)};function a(){for(var e,r,t=Array.from(document.querySelectorAll("section.survey-question")),a=[],d=0;d<t.length;d++){var c={},l=t[d],v=l.getAttribute("data-question-type"),p=l.getAttribute("data-question-id");if(!(p&&Number.isInteger(parseInt(p))&&(e=v,r=u,r.has(e))))return void o("error","Something went wrong submitting the survey.");c.question_id=parseInt(p),c.question_type=v;var f=l.querySelector("input#confirm_response_question_".concat(d+1)),y=l.querySelector("div[data-pq-answer]");if(!y)return void s(l,"Invalid survey question type.");switch(c.required=!f,c.confirmed_response=Boolean(f&&f.checked),v){case"survey-audio":var q=y.querySelector("audio"),h=y.querySelector('input[type="text"][name^="audio-input-title"]');if(c.required&&(!q||!q.getAttribute("data-src")||!h||!h.value||!h.checkValidity()))return void s(l,"Invalid audio input. Unable to find audio input or audio title is not valid.");q&&q.getAttribute("data-src")&&h&&h.checkValidity()&&(c.response={src:String(q.getAttribute("data-src")),title:h.value});break;case"survey-checkbox":var m=y.querySelector('span[id^="min_select_"]'),b=y.querySelector('span[id^="max_select_"]'),g=Array.from(y.querySelectorAll('input[type="checkbox"]:checked')).filter((function(e){return Number.isInteger(parseInt(e.value))})).map((function(e){return parseInt(e.value)}));if(m){var k=parseInt(m.innerText.trim());if(Number.isInteger(k)&&g.length<k)return void s(l,"The number of selections for the checkbox question cannot be less than the required minimum number of selections.")}if(b&&(k=parseInt(b.innerText.trim()),Number.isInteger(k)&&g.length>k))return void s(l,"The number of selections for the checkbox question cannot be greater than the allowed maximum number of selections.");c.response={choices:g};break;case"survey-color":if(!(P=y.querySelector('input[type="color"]'))&&c.required)return void s(l,"Unable to find color input for required question.");if(P){var S=P.checkValidity();if(c.required&&!S)return void s(l,"Invalid color input for required question.");var I=P.value;c.response={color:I}}break;case"survey-date":if(!(P=y.querySelector('input[type="date"]'))&&c.required)return void s(l,"Unable to find date input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid date input for required question.");I=P.value,c.response={date:I}}break;case"survey-datetime":if(!(P=y.querySelector('input[type="datetime-local"]'))&&c.required)return void s(l,"Unable to find datetime input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid datetime input for required question.");I=P.value,c.response={datetime:I}}break;case"survey-image":var w=y.querySelector("input[data-image-input]").id,x=y.querySelector('input[name="'.concat(w,'-text"]')),_=y.querySelector('input[name="'.concat(w,'-short-description"]')),A=y.querySelector('textarea[name="'.concat(w,'-long-description"]'));if(c.required&&(!x||!x.value||!_||!_.checkValidity()||!A||!A.checkValidity()))return void s(l,"Invalid image input. Unable to find image input, or image ");x&&x.value&&_&&A&&(c.response={src:x.value,short_description:_.value,long_description:A.value});break;case"survey-month":if(!(P=y.querySelector('input[type="month"]'))&&c.required)return void s(l,"Unable to find month input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid month input for required question.");I=P.value,c.response={month:I}}break;case"survey-multiple-choice":var U=y.querySelector('input[type="radio"]:checked');if(c.required&&!U)return void s(l,"You must select a choice for this survey question.");if(U){if(I=U.value,!Number.isInteger(parseInt(I)))return void s(l,"Invalid choice for multiple choice question.");c.response={choice:parseInt(I)}}break;case"survey-number":if(!(P=y.querySelector('input[type="number"]'))&&c.required)return void s(l,"Unable to find number input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid number input for required question.");I=P.value,c.response={number:Number(I)}}break;case"survey-paragraph":if(!(P=y.querySelector("textarea"))&&c.required)return void s(l,"Unable to find paragraph input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid paragraph input for required question.");I=P.value,c.response={response:I}}break;case"survey-range":if(!(P=y.querySelector('input[type="range"]'))&&c.required)return void s(l,"Unable to find range input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid range input for required question.");I=P.value,c.response={input:Number(I)}}break;case"survey-ranking":var V=Array.from(y.querySelectorAll("div[data-pr-option]")).filter((function(e){return Number.isInteger(parseInt(e.id.replace("option-","")))})).map((function(e){return parseInt(e.id.replace("option-",""))}));if(c.required&&!V.length)return void s(l,"Invalid survey question response.");V.length&&(c.response={ordered:V});break;case"survey-selection":var N=y.querySelector('input[id^="select_input_"]'),E=y.querySelector('input[id^="checkbox_"]'),T=y.querySelector('input[id^="other_option_"]');if(c.required&&!N)return void s(l,"Unable to find select input for required survey question.");if(N){var C=N.value;if(U=Number.isInteger(parseInt(C))?parseInt(C):void 0,E&&E.checked){if(!T||!T.value.length)return void s(l,'If you want to submit an "other option" for a select input question, then the length of the response for the other value must be greater than 1.');c.response={choice:U,other_checked:!0,other_option:T.value};break}if(!U&&c.required)return void s(l,"Unable to find input for required survey select question.");c.response={choice:U,other_checked:!1,other_option:void 0}}break;case"survey-short-answer":if(!(P=y.querySelector('input[type="text"][id^="ursa_"]'))&&c.required)return void s(l,"Unable to find text input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid text input for required question.");I=P.value,c.response={response:I}}break;case"survey-short-blog":var B=y.querySelector("div.lexical-wrapper");if(!B&&c.required)return void s(l,"Unable to find short blog input for required question.");if(B){w=B.id;var O=(0,i.getEditorInstances)()[w];if(!O&&c.required)return void s(l,"Unable to find short blog input for required question.");c.response={editorState:JSON.stringify(O.toJSON())}}break;case"survey-time":var P;if(!(P=y.querySelector('input[type="time"]'))&&c.required)return void s(l,"Unable to find time input for required question.");if(P){if(S=P.checkValidity(),c.required&&!S)return void s(l,"Invalid time input for required question.");I=P.value,c.response={time:I}}break;case"survey-video":var H=y.querySelector("video"),J=y.querySelector('input[type="text"][name^="video-input-title"]'),L=y.querySelector('textarea[name^="video-input-description"]');if(c.required&&(!H||!H.getAttribute("data-src")||!J||!J.value.length||!L||!H.videoHeight))return void s(l,"Invalid video survey question response.");H&&H.getAttribute("data-src")&&J&&J.value.length&&L&&(c.response={src:String(H.getAttribute("data-src")),title:J.value,description:L.value,height:H.videoHeight});break;case"survey-week":throw new Error("This question type has not been implemented yet.");default:return void s(l,"Invalid survey question type.")}a.push(c)}var G=window.location.pathname;(0,n.Mr)("Submitting Survey response..."),fetch(G,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":(0,n.Qm)()},body:JSON.stringify({responses:a})}).then((function(e){if(200!==e.status)throw new Error("Something went wrong posting the survey response.");(0,n.xw)(),o("success","Successfully posted survey response!"),setTimeout((function(){if(window.htmx){var e=document.createElement("div"),r=document.getElementById("PAGE");r&&r.append(e),e.setAttribute("hx-get","/surveys"),e.setAttribute("hx-target","#PAGE"),e.setAttribute("hx-push-url","true"),e.setAttribute("hx-indicator","#page-transition-progress"),e.setAttribute("hx-trigger","click"),window.htmx.process(e),window.htmx.trigger(e,"click")}}),1e3)})).catch((function(e){console.error(e),(0,n.xw)(),o("error","Something went wrong posting the survey response")}))}function d(){var e=document.getElementById("submit-survey-response-button");e&&e.addEventListener("click",a)}}}]);