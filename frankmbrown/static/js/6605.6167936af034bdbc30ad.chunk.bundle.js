"use strict";(self.webpackChunkbundled_client_code=self.webpackChunkbundled_client_code||[]).push([[6605],{56605:function(e,t,r){r.r(t),r.d(t,{onLoadArticleBuilderFinal:function(){return M},onUnloadArticleBuilder:function(){return H}});var n=r(8189),i=r(22705),a=r(60429),o=r(68254),c=function(){return c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c.apply(this,arguments)},l=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function c(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},d=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(l){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}},u=null,s=void 0,f=void 0;function p(e){var t="s_".concat(window.crypto.randomUUID()),r='\n  <div id="'.concat(t,'" class="snackbar error filled medium icon" aria-hidden="false" role="alert" data-snacktime="4000">\n    <svg focusable="false" inert viewBox="0 0 24 24" tabindex="-1" title="Code"><path d="M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg>\n    <p class="p-sm">').concat(e,'</p>\n    <button class="icon medium" type="button" data-close-snackbar aria-label="Close Snackbar">\n      <svg focusable="false" inert viewBox="0 0 24 24" tabindex="-1" title="CloseSharp"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>\n    </button>\n  </div>\n  ');document.body.insertAdjacentHTML("beforeend",r),document.dispatchEvent(new CustomEvent("NEW_CONTENT_LOADED")),setTimeout((function(){var e=document.getElementById(t);e&&e.remove()}),4e3)}function m(e){var t=e.nextElementSibling;if(t){var r=t.querySelector('div[data-codemirror="html"]'),n=t.querySelector('div[data-codemirror="css"]');if(r&&n){var a=r.closest("div[data-editor-wrapper]"),c=n.closest("div[data-editor-wrapper]");if(a&&c){var l=a.id,d=c.id;if(l&&d){var u=(0,i.getCodeMirrorEditorText)(l),s=(0,i.getCodeMirrorEditorText)(d);if("string"==typeof u&&"string"==typeof s)return{html:(0,o.purifyUserInputHTML)(u),css:s}}}}}return null}function v(e){var t=e.nextElementSibling;if(t){var r=t.querySelector('div[data-codemirror="markdown"]');if(r){var n=r.closest("div[data-editor-wrapper]");if(n){var a=n.id;if(a){var o=(0,i.getCodeMirrorEditorText)(a);if("string"==typeof o)return{markdown:o}}}}}return null}function h(e){var t=e.querySelector('input[type="text"][data-article-title]'),r=e.querySelector("textarea[data-article-description]"),i=e.querySelector('input[type="file"][data-article-image]'),a=e.querySelector('input[type="text"][data-article-version]'),o=Array.from(e.querySelectorAll("section[data-article-builder]"));if(t&&o){var l=void 0,d=void 0,u=void 0;if(r&&(l=r.value),i){var s=i.getAttribute("name");if(s){var f=document.querySelector('input[name="'.concat(s.concat("-text"),'"]'));f&&f.value&&(d=f.value)}}a&&(u=parseInt(a.value),!isNaN(u)&&isFinite(u)||(u=void 0));var p=t.value,h=[];return o.forEach((function(e){var t=e.getAttribute("data-type");if("code"===t){if(d=e.querySelector("div.tabs")){var r=m(d);r&&h.push(c({type:"code"},r))}}else if("lexical"===t){var i=e.querySelector("div.lexical-wrapper");if(i){var a=i.id;if(a){var o=(0,n.getEditorInstances)()[a];if(o){var l=o.getEditorState().toJSON();l&&h.push({type:"lexical",state:l})}}}}else if("markdown"===t){var d;if(d=e.querySelector("div.tabs")){var u=v(d);u&&h.push({type:"markdown",markdown:u.markdown})}}})),{title:p,sectionStates:h,description:l,image:d,version:u}}return null}function b(e){var t=this.closest("output");if(t){var r=t.querySelector("article[data-preview-mobile]"),i=t.querySelector("article[data-preview-tablet]"),a=t.querySelector("article[data-preview-desktop]");if(r&&i&&a){var o=t.getAttribute("form");if(o){var c=document.getElementById(o);if(c){t.setAttribute("hidden",""),c.removeAttribute("hidden");var l=Array.from(t.querySelectorAll("div.lexical-wrapper"));l.length&&l.forEach((function(e){var t=e.id;t&&(0,n.clearEditor)(t)})),r.innerHTML="",i.innerHTML="",a.innerHTML=""}}}else p("Unable to find mobile, tablet, or desktop output <article> elements.")}else console.error("There should be an output here.")}function y(e){var t=document.createElement("div");t.classList.add("lexical-wrapper","example-render"),t.style.setProperty("padding","0px","important"),t.setAttribute("data-rich-text-editor","");var r="sect_".concat(window.crypto.randomUUID());t.setAttribute("id",r),(0,n.registerFullEditor)(t);var i=(0,n.getEditorInstances)()[r];if(i){var a=i.parseEditorState(e);return i.setEditorState(a),i.setEditable(!1),t}return null}function w(e){return l(this,void 0,void 0,(function(){var e,t,r,n,i,a,c,l,u,s,f,m,v,b,w;return d(this,(function(d){switch(d.label){case 0:if(e=this.closest("form"),t=document.querySelector("html"),!e||!t)return[3,7];if(r=e.id,!(n=h(e))||!r)return[3,7];if(i=document.querySelector('output[form="'.concat(r,'"]')),n.title.trim().length<1||n.title.trim().length>50)return p("Article title must be between 1 and 50 characters."),[2];if(!n.sectionStates.length)return p("There must be at least one article section for the article to be valid."),[2];if(!i)return p("There must be an output element for the form#".concat(r," to preview the article.")),[2];if(a=i.querySelector("article[data-preview-mobile]"),c=i.querySelector("article[data-preview-tablet]"),l=i.querySelector("article[data-preview-desktop]"),!a||!c||!l)return p("Unable to find mobile, tablet, or desktop output <article> elements."),[2];(u=document.createElement("h1")).classList.add("page-title"),u.innerText=n.title,a.append(u.cloneNode(!0)),c.append(u.cloneNode(!0)),l.append(u.cloneNode(!0)),s=[],f=0,d.label=1;case 1:return f<n.sectionStates.length?"lexical"!==(m=n.sectionStates[f]).type?[3,2]:(s.push(m.state),[3,5]):[3,6];case 2:return"code"!==m.type?[3,3]:((b=document.createElement("div")).style.setProperty("overflow","hidden","important"),(v=document.createElement("style")).innerText=m.css,b.append(v),b.insertAdjacentHTML("beforeend",(0,o.purifyUserInputHTML)(m.html)),s.push(b.outerHTML),[3,5]);case 3:return"markdown"!==m.type?[3,5]:((b=document.createElement("div")).style.setProperty("overflow","hidden","important"),[4,(0,o.parseMarkdown)(m.markdown,{useDesignSystem:!1,breaks:!0,gfm:!0,pedantic:!1})]);case 4:w=d.sent(),b.insertAdjacentHTML("afterbegin",w),s.push(b.outerHTML),d.label=5;case 5:return f++,[3,1];case 6:s.filter((function(e){return null!==e})).forEach((function(e){if("string"==typeof e)a.insertAdjacentHTML("beforeend",e),c.insertAdjacentHTML("beforeend",e),l.insertAdjacentHTML("beforeend",e);else{var t=y(e),r=y(e),n=y(e);t&&r&&n&&(a.append(t),c.append(r),l.append(n))}})),document.dispatchEvent(new CustomEvent("NEW_CONTENT_LOADED")),e.setAttribute("hidden",""),i.removeAttribute("hidden"),d.label=7;case 7:return[2]}}))}))}function g(e){e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}function E(e){var t="submit";"publish"===this.getAttribute("data-submit")?t="publish":"save"===this.getAttribute("data-submit")&&(t="save");var r=this.closest("form");if(r){var n=r.getAttribute("data-hx-params"),i=r.getAttribute("data-loading"),o=r.getAttribute("data-hx-post");if(n)for(var l="",d=0,s=n.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length}));d<s.length;d++){var f=s[d],m=r.querySelector('input[name="'.concat(f,'"]'));m&&(l.length?l+="&":l+="?",l+="".concat(f,"=").concat(m.value))}var v=r.getAttribute("data-hx-target"),b=r.getAttribute("data-hx-swap");u=h(r);var y=c(c({},u),{submitType:t}),w=null;y&&o&&(i&&(w=document.getElementById("loading-dialog"))&&(0,a.pX)(w,i),fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":(0,a.Qm)()},body:JSON.stringify(y)}).then((function(e){if(200!==e.status)throw new Error("Network request");return e.text()})).then((function(e){if(v){var t=document.querySelector(v),r=document.createElement("div");r.insertAdjacentHTML("afterbegin",e),t&&(b&&"innerHTML"!==b?"outerHTML"===b?(t.outerHTML=r.outerHTML,window.htmx&&window.htmx.process(r)):"beforebegin"===b?(t.insertAdjacentElement("beforebegin",r),window.htmx&&window.htmx.process(r)):"afterbegin"===b?(t.insertAdjacentElement("afterbegin",r),window.htmx&&window.htmx.process(r)):"beforeend"===b?(t.insertAdjacentElement("beforeend",r),window.htmx&&window.htmx.process(r)):"afterend"===b?(t.insertAdjacentElement("afterend",r),window.htmx&&window.htmx.process(r)):"delete"===b&&(t.remove(),window.htmx&&window.htmx.process(r)):(t.innerHTML=r.outerHTML,window.htmx&&window.htmx.process(r)),document.dispatchEvent(new CustomEvent("NEW_CONTENT_LOADED")))}w&&(0,a.zU)(w)})).catch((function(e){console.error(e),w&&(0,a.zU)(w),p("Something went wrong submitting the article.")})))}}function S(e){return l(this,void 0,void 0,(function(){var e,t,r,n,i,a;return d(this,(function(o){return(e=this.closest("div.tabs"))&&(t=e.nextElementSibling)&&(r=m(e),(n=t.querySelector("div[data-code-output-div]"))&&r&&(n.innerHTML="",(i=document.createElement("div")).style.setProperty("overflow","hidden","important"),(a=document.createElement("style")).innerText=r.css,i.append(a),i.insertAdjacentHTML("beforeend",r.html),n.append(i))),[2]}))}))}function A(e){return l(this,void 0,void 0,(function(){var e,t,r,n,i,a;return d(this,(function(c){switch(c.label){case 0:return(e=this.closest("div.tabs"))&&(t=e.nextElementSibling)?(r=v(e),(n=t.querySelector("div[data-markdown-output-div]"))&&r?(n.innerHTML="",(i=document.createElement("div")).style.setProperty("overflow","hidden","important"),[4,(0,o.parseMarkdown)(r.markdown,{useDesignSystem:!1,breaks:!0,gfm:!0,pedantic:!1})]):[3,2]):[3,2];case 1:a=c.sent(),i.insertAdjacentHTML("beforeend",a),n.append(i),c.label=2;case 2:return[2]}}))}))}function x(e){var t=this.closest("section");t&&(f=t.id)}function k(e){if(f){var t=document.getElementById(f),r=document.querySelector("form[data-article-builder-final]");if(r&&t){var n=Array.from(r.querySelectorAll("section[data-article-builder]"));if(n&&n.length>=2){var i=document.getElementById("del-article-section");(0,a.QO)("#del-article-section"),i&&i.style.setProperty("display","none"),t.remove(),i&&i.style.setProperty("display","none"),(0,a.QO)("#del-article-section"),q(r),f=void 0}}}}function L(e){var t=this.id;t&&(s=t)}function T(e){if(e.ctrlKey&&"s"===e.key.toLowerCase()){if(e.preventDefault(),s){var t=document.getElementById(s);if(t){var r=t.querySelector('button[type="submit"][data-submit="save"]');r&&r.dispatchEvent(new Event("click"))}}return!1}e.ctrlKey&&"h"===e.key.toLowerCase()?(e.preventDefault(),Array.from(document.querySelectorAll("section[data-article-builder] button[data-hide-show]")).forEach((function(e){var t=document.getElementById(String(e.getAttribute("data-el")).slice(1));t&&!t.hasAttribute("hidden")&&e.click()}))):e.ctrlKey&&"o"===e.key.toLowerCase()&&(e.preventDefault(),Array.from(document.querySelectorAll("section[data-article-builder] button[data-hide-show]")).forEach((function(e){var t=document.getElementById(String(e.getAttribute("data-el")).slice(1));t&&t.hasAttribute("hidden")&&e.click()})))}function q(e){var t=e.id;e.addEventListener("focusin",L),e.addEventListener("submit",g,!0);var r=Array.from(e.querySelectorAll('button[type="submit'));r&&r.forEach((function(e){return e.addEventListener("click",E,!0)})),e.querySelectorAll("button[data-output-code]").forEach((function(e){e.addEventListener("click",S)})),e.querySelectorAll("button[data-output-markdown]").forEach((function(e){e.addEventListener("click",A)}));var n=Array.from(e.querySelectorAll("section[data-article-builder]"));n.forEach((function(e){var t=e.querySelector('button[data-pelem="#del-article-section"]');t&&(1!==n.length||t.hasAttribute("disabled")?n.length>1&&t.hasAttribute("disabled")&&t.removeAttribute("disabled"):t.setAttribute("disabled",""),t.addEventListener("click",x))}));var i=e.querySelector("button[data-preview-article]");if(i&&i.addEventListener("click",w),t){var a=document.querySelector('output[form="'.concat(t,'"]'));if(a){var o=a.querySelector("button[data-edit-article]");o&&o.addEventListener("click",b)}}var c=document.getElementById("del-article-section-btn");c&&c.addEventListener("click",k),document.addEventListener("keydown",T,!0)}function M(){var e=Array.from(document.querySelectorAll("form[data-article-builder-final]"));e.length&&e.forEach((function(e){return q(e)}))}function H(){u=null,document.removeEventListener("keydown",T)}}}]);